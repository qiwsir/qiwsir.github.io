<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="专注于编程技术和数据科学、人工智能">
  <meta name="keyword" content="人工智能, 数据科学, Python, 编程, 程序员, 开发者, web, 网站, 语言, 程序, UI, 美工, 设计师">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      Python虚拟环境 | 老齐教室
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


<meta name="generator" content="Hexo 4.2.0"></head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>老齐教室</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">首页</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">书籍</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/courses/" class="item-link">课程</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">类目</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/resources/" class="item-link">资源</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">关于</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">首页</a>
            

          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">书籍</a>
            

          </li>
        
          <li class="menu-item">
            
              <a href="/courses/" class="menu-link">课程</a>
            

          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">类目</a>
            

          </li>
        
          <li class="menu-item">
            
              <a href="/resources/" class="menu-link">资源</a>
            

          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">关于</a>
            

          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  
  <!-- <div class="arrow-down">
    <a href="javascript:;"></a>
  </div> -->
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <h2>Python虚拟环境</h2>
    <p class="post-date">2021-03-08</p>
    <section class="markdown-content"><h2 id="导言"><a href="#导言" class="headerlink" title="导言"></a>导言</h2><p>本文是针对<a href="http://www.itdiffer.com/python_course.html" target="_blank" rel="noopener">《Python大学实用教程》</a>和<a href="http://www.itdiffer.com/learn_python.html" target="_blank" rel="noopener">《跟老齐学Python：轻松入门》</a>两本书的基础内容之后的提升。</p>
<p>通常，在不同的项目中，会用到不同的Python版本——如果有必要的话，也包括一些库的版本，并非总是最新的就是最适合的或者最好的。对此，解决之道就是创建虚拟环境。</p>
<p>一个项目创建一个虚拟环境，在每个虚拟环境之中，就相当于一个“裸机”，里面所需要的东西任你根据当前的需要自由配置，并且不会影响到其他项目。特别是在诸如Linux系统上，有时候安装某些东西还需要root权限，此时虚拟环境的好处就更明显了。</p>
<h2 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h2><p>不论是Python2，还是Python3中，都可以创建虚拟环境——虽然现在广泛使用Python3，但也有项目在Python2上跑着呢。只是两个版本中创建方法稍有区别。</p>
<h3 id="在Python3中创建虚拟环境"><a href="#在Python3中创建虚拟环境" class="headerlink" title="在Python3中创建虚拟环境"></a>在Python3中创建虚拟环境</h3><p>下面的方法是Python3中推荐的方法，务必掌握。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -m venv python3venv</span><br></pre></td></tr></table></figure>

<p>命令行上的<code>-m</code>参数是告诉解释器运行<code>venv</code>模块，此模块是Python3核心发行版的一部分。<code>python3venv</code>是虚拟环境的目录名称。执行之后就会创建<code>python3venv</code>，虚拟环境就在这个目录中。</p>
<p>如果对<code>venv</code>好奇，可以用下面的方式来瞧一瞧。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ python3</span><br><span class="line">Python <span class="number">3.6</span><span class="number">.4</span> (v3<span class="number">.6</span><span class="number">.4</span>:d48ecebad5, Dec <span class="number">18</span> <span class="number">2017</span>, <span class="number">21</span>:<span class="number">07</span>:<span class="number">28</span>)</span><br><span class="line">[GCC <span class="number">4.2</span><span class="number">.1</span> (Apple Inc. build <span class="number">5666</span>) (dot <span class="number">3</span>)] on darwin</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> venv</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(venv)</span><br><span class="line">&lt;module <span class="string">'venv'</span> <span class="keyword">from</span> <span class="string">'/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/venv/__init__.py'</span>&gt;</span><br></pre></td></tr></table></figure>

<p><code>venv</code>模块的代码在<code>/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/venv/__init__.py</code>，查看此文件（执行<code>cat /Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/venv/__init__.py</code>即可看到），并到最底部，会看到如下内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    rc = <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        main()</span><br><span class="line">        rc = <span class="number">0</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">'Error: %s'</span> % e, file=sys.stderr)</span><br><span class="line">    sys.exit(rc)</span><br></pre></td></tr></table></figure>

<p>如果要查看命令行的参数，可以：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -m venv</span><br><span class="line">usage: venv [-h] [--system-site-packages] [--symlinks | --copies] [--clear]</span><br><span class="line">            [--upgrade] [--without-pip] [--prompt PROMPT]</span><br><span class="line">            ENV_DIR [ENV_DIR ...]</span><br><span class="line">venv: error: the following arguments are required: ENV_DIR</span><br></pre></td></tr></table></figure>

<h3 id="在Python3-6及更低版本中创建虚拟环境"><a href="#在Python3-6及更低版本中创建虚拟环境" class="headerlink" title="在Python3.6及更低版本中创建虚拟环境"></a>在Python3.6及更低版本中创建虚拟环境</h3><p>现在不推荐这种方法，但是，也介绍一下。因为这个方法主要用于Python3.6及以下版本中。</p>
<p>Python3.6及以下版本有一个名为<code>pyvenv</code>的可执行文件，它本质上是<code>venv</code>模块的二进制包装器。如果按按照下面的方法操作，就可以看到命令行的参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ pyvenv</span><br><span class="line">WARNING: the pyenv script <span class="keyword">is</span> deprecated <span class="keyword">in</span> favour of `python3<span class="number">.6</span> -m venv`</span><br><span class="line">usage: venv [-h] [--system-site-packages] [--symlinks | --copies] [--clear]</span><br><span class="line">            [--upgrade] [--without-pip] [--prompt PROMPT]</span><br><span class="line">            ENV_DIR [ENV_DIR ...]</span><br><span class="line">venv: error: the following arguments are required: ENV_DIR</span><br></pre></td></tr></table></figure>

<p>使用它创建虚拟目录的方法是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pyvenv python3venv</span><br><span class="line">WARNING: the pyenv script <span class="keyword">is</span> deprecated <span class="keyword">in</span> favour of `python3<span class="number">.6</span> -m venv`</span><br></pre></td></tr></table></figure>

<p>但是，会告诉我们，这个东西弃用了，后面要使用前面推荐的方法。</p>
<h3 id="在Python2-x中创建虚拟环境"><a href="#在Python2-x中创建虚拟环境" class="headerlink" title="在Python2.x中创建虚拟环境"></a>在Python2.x中创建虚拟环境</h3><p>在Python2.x上，用<code>virtualenv</code>模块创建虚拟环境。在不同的操作系统中，对<code>virtualenv</code>可能有不同的处理方式，比如有的默认就安装了这个模块，有的没有安装，这就需要你先安装上。</p>
<p>检查一下它是不是在你的机器上了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ which virtualenv</span><br><span class="line">/Library/Frameworks/Python.framework/Versions/<span class="number">2.7</span>/bin/virtualenv</span><br></pre></td></tr></table></figure>

<p>创建一个Python2.x的虚拟目录，其语法类似于前面的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ virtualenv python2venv</span><br><span class="line">New python executable <span class="keyword">in</span> /Users/james/python2venv/bin/python</span><br><span class="line">Installing setuptools, pip, wheel...done.</span><br></pre></td></tr></table></figure>

<h2 id="检查虚拟环境"><a href="#检查虚拟环境" class="headerlink" title="检查虚拟环境"></a>检查虚拟环境</h2><p>已经创建了两个虚拟环境的目录，分别是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ls python3venv python2venv/</span><br><span class="line">python2venv/:</span><br><span class="line">bin	include	lib</span><br><span class="line"></span><br><span class="line">python3venv:</span><br><span class="line">bin		include		lib		pyvenv.cfg</span><br></pre></td></tr></table></figure>

<p>这两个目录的却别在于，<code>python3venv</code>中能够看到<code>pyvenv.cfg</code>文件，如果你有兴趣了解有关此文件的更多信息，可以在<a href="https://www.python.org/dev/peps/pep-0405/" target="_blank" rel="noopener">PEP-0405</a>查看相关的背景知识。</p>
<h2 id="激活虚拟环境"><a href="#激活虚拟环境" class="headerlink" title="激活虚拟环境"></a>激活虚拟环境</h2><p>要使用虚拟环境，必须先激活。</p>
<p>注意，虚拟环境激活前后，shell的提示符会发生变化。原来是这样的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ echo $PATH</span><br><span class="line">/Library/Frameworks/Python.framework/Versions/<span class="number">3.6</span>/bin:/Library/Frameworks/Python.framework/Versions/<span class="number">2.7</span>/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin</span><br></pre></td></tr></table></figure>

<p>激活虚拟环境之后（执行<code>source python3venv/bin/activate</code>指令后）显示<code>(python3venv) $</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ source python3venv/bin/activate</span><br><span class="line">(python3venv) $</span><br></pre></td></tr></table></figure>

<p>检查路径后，虚拟环境将优先于前面做同样操作是呈现的路径。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(python3venv) $ echo $PATH</span><br><span class="line">/Users/james/python3venv/bin:/Library/Frameworks/Python.framework/Versions/<span class="number">3.6</span>/bin:/Library/Frameworks/Python.framework/Versions/<span class="number">2.7</span>/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin</span><br></pre></td></tr></table></figure>

<h3 id="执行python"><a href="#执行python" class="headerlink" title="执行python"></a>执行python</h3><p>如果我们现在执行<code>python</code>或<code>pip</code>，由于路径优先（前面的操作已经显示，python3.6优先执行了虚拟环境中），来自虚拟环境命令将优先执行。如果用下面的方式查看，会发现它们都在相应的虚拟环境中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(python3venv) $ which python</span><br><span class="line">/Users/james/python3venv/bin/python</span><br><span class="line">(python3venv) $ which pip</span><br><span class="line">/Users/james/python3venv/bin/pip</span><br></pre></td></tr></table></figure>

<p>比如执行<code>python</code>，本来本地机器上安装两个版本的Python，如果不用虚拟环境，<code>python</code>之后默认会执行Python2，要执行Python3，必须是<code>python3</code>。但是，现在不同了，因为激活了Python3.6的虚拟环境，当执行<code>python</code>命令后，会首先在指定的虚拟环境中搜索。并且，进入到Python3之后，查看<code>sys.path</code>，当前虚拟环境目录也被添加到Python搜索路径中了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(python3venv) $ python</span><br><span class="line">Python <span class="number">3.6</span><span class="number">.4</span> (v3<span class="number">.6</span><span class="number">.4</span>:d48ecebad5, Dec <span class="number">18</span> <span class="number">2017</span>, <span class="number">21</span>:<span class="number">07</span>:<span class="number">28</span>)</span><br><span class="line">[GCC <span class="number">4.2</span><span class="number">.1</span> (Apple Inc. build <span class="number">5666</span>) (dot <span class="number">3</span>)] on darwin</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sys</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(sys.path)</span><br><span class="line">[<span class="string">''</span>, <span class="string">'/Library/Frameworks/Python.framework/Versions/3.6/lib/python36.zip'</span>, <span class="string">'/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6'</span>, <span class="string">'/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/lib-dynload'</span>, <span class="string">'/Users/james/python3venv/lib/python3.6/site-packages'</span>]</span><br></pre></td></tr></table></figure>

<h3 id="用pip安装软件包"><a href="#用pip安装软件包" class="headerlink" title="用pip安装软件包"></a>用pip安装软件包</h3><p>激活虚拟环境后，使用<code>pip</code>会将模块或者第三方包直接安装到虚拟环境。例如，如果我们安装了名为<code>arrow</code>的模块——专门解读日期、时间的模块，比传统的<code>datatime</code>模块使用更方便。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(python3venv) $ pip install arrow</span><br><span class="line">Collecting arrow</span><br><span class="line">  Downloading https://files.pythonhosted.org/packages/f4/<span class="number">7</span>f/<span class="number">0360628</span>ba40bb93c10cd89cd289b6a8e9ea87b2db884b8edf32c80ee1c73/arrow<span class="number">-0.13</span><span class="number">.1</span>-py2.py3-none-any.whl</span><br><span class="line">Collecting python-dateutil (<span class="keyword">from</span> arrow)</span><br><span class="line">  Downloading https://files.pythonhosted.org/packages/<span class="number">41</span>/<span class="number">17</span>/c62faccbfbd163c7f57f3844689e3a78bae1f403648a6afb1d0866d87fbb/python_dateutil<span class="number">-2.8</span><span class="number">.0</span>-py2.py3-none-any.whl (<span class="number">226</span>kB)</span><br><span class="line">    <span class="number">100</span>% |████████████████████████████████| <span class="number">235</span>kB <span class="number">3.6</span>MB/s</span><br><span class="line">Collecting six&gt;=1.5 (from python-dateutil-&gt;arrow)</span><br><span class="line">  Downloading https://files.pythonhosted.org/packages/<span class="number">73</span>/fb/<span class="number">00</span>a976f728d0d1fecfe898238ce23f502a721c0ac0ecfedb80e0d88c64e9/six<span class="number">-1.12</span><span class="number">.0</span>-py2.py3-none-any.whl</span><br><span class="line">Installing collected packages: six, python-dateutil, arrow</span><br><span class="line">Successfully installed arrow<span class="number">-0.13</span><span class="number">.1</span> python-dateutil<span class="number">-2.8</span><span class="number">.0</span> six<span class="number">-1.12</span><span class="number">.0</span></span><br><span class="line">You are using pip version <span class="number">9.0</span><span class="number">.1</span>, however version <span class="number">19.0</span><span class="number">.3</span> <span class="keyword">is</span> available.</span><br><span class="line">You should consider upgrading via the <span class="string">'pip install --upgrade pip'</span> command.</span><br></pre></td></tr></table></figure>

<p>上面的安装过程显示，在安装了<code>arrow</code>的过程中，还安装了<code>six</code>和<code>python-dateutil</code>两个依赖模块。我们可以再次确认<code>arrow</code>模块在虚拟环境中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(python3venv) $ python</span><br><span class="line">Python <span class="number">3.6</span><span class="number">.4</span> (v3<span class="number">.6</span><span class="number">.4</span>:d48ecebad5, Dec <span class="number">18</span> <span class="number">2017</span>, <span class="number">21</span>:<span class="number">07</span>:<span class="number">28</span>)</span><br><span class="line">[GCC <span class="number">4.2</span><span class="number">.1</span> (Apple Inc. build <span class="number">5666</span>) (dot <span class="number">3</span>)] on darwin</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> arrow</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(arrow)</span><br><span class="line">&lt;module <span class="string">'arrow'</span> <span class="keyword">from</span> <span class="string">'/Users/james/python3venv/lib/python3.6/site-packages/arrow/__init__.py'</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="升级pip"><a href="#升级pip" class="headerlink" title="升级pip"></a>升级pip</h3><p>在上面用<code>pip</code>安装的时候，最后有警公告，提示要升级<code>pip</code>，如果看到这个提示，就要必须升级，为什么？请阅读：</p>
<p><strong><a href="https://qiwsir.github.io/2021/02/27/upgrade-pip/">必须升级pip，为什么？！</a></strong></p>
<p>可以按以下方式升级虚拟环境中的<code>pip</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(python3venv) $ pip install --upgrade pip</span><br><span class="line">Cache entry deserialization failed, entry ignored</span><br><span class="line">Collecting pip</span><br><span class="line">  Using cached https://files.pythonhosted.org/packages/d8/f3/<span class="number">413</span>bab4ff08e1fc4828dfc59996d721917df8e8583ea85385d51125dceff/pip<span class="number">-19.0</span><span class="number">.3</span>-py2.py3-none-any.whl</span><br><span class="line">Installing collected packages: pip</span><br><span class="line">  Found existing installation: pip <span class="number">9.0</span><span class="number">.1</span></span><br><span class="line">    Uninstalling pip<span class="number">-9.0</span><span class="number">.1</span>:</span><br><span class="line">      Successfully uninstalled pip<span class="number">-9.0</span><span class="number">.1</span></span><br><span class="line">Successfully installed pip<span class="number">-19.0</span><span class="number">.3</span></span><br><span class="line"></span><br><span class="line">(python3venv) $ pip --version</span><br><span class="line">pip <span class="number">19.0</span><span class="number">.3</span> <span class="keyword">from</span> /Users/james/python3venv/lib/python3<span class="number">.6</span>/site-packages/pip (python <span class="number">3.6</span>)</span><br></pre></td></tr></table></figure>

<p>（<strong>注意：</strong>上面显示，不一定是你阅读到本文的时候<code>pip</code>的最新版本。）</p>
<h3 id="集成环境需求"><a href="#集成环境需求" class="headerlink" title="集成环境需求"></a>集成环境需求</h3><p>为了让下面的示例更能说明问题，在安装<code>flask</code>——一个用于web开发的框架。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(python3venv) $ pip install flask</span><br><span class="line">Collecting flask</span><br><span class="line">  Downloading https://files.pythonhosted.org/packages/<span class="number">7</span>f/e7/<span class="number">08578774</span>ed4536d3242b14dacb4696386634607af824ea997202cd0edb4b/Flask<span class="number">-1.0</span><span class="number">.2</span>-py2.py3-none-any.whl (<span class="number">91</span>kB)</span><br><span class="line">    <span class="number">100</span>% |████████████████████████████████| <span class="number">92</span>kB <span class="number">2.4</span>MB/s</span><br><span class="line">Collecting Jinja2&gt;=<span class="number">2.10</span> (<span class="keyword">from</span> flask)</span><br><span class="line">  Downloading https://files.pythonhosted.org/packages/<span class="number">7</span>f/ff/ae64bacdfc95f27a016a7bed8e8686763ba4d277a78ca76f32659220a731/Jinja2<span class="number">-2.10</span>-py2.py3-none-any.whl (<span class="number">126</span>kB)</span><br><span class="line">    <span class="number">100</span>% |████████████████████████████████| <span class="number">133</span>kB <span class="number">7.6</span>MB/s</span><br><span class="line">Collecting Werkzeug&gt;=<span class="number">0.14</span> (<span class="keyword">from</span> flask)</span><br><span class="line">  Downloading https://files.pythonhosted.org/packages/<span class="number">20</span>/c4/<span class="number">12e3</span>e56473e52375aa29c4764e70d1b8f3efa6682bef8d0aae04fe335243/Werkzeug<span class="number">-0.14</span><span class="number">.1</span>-py2.py3-none-any.whl (<span class="number">322</span>kB)</span><br><span class="line">    <span class="number">100</span>% |████████████████████████████████| <span class="number">327</span>kB <span class="number">13.0</span>MB/s</span><br><span class="line">Collecting itsdangerous&gt;=<span class="number">0.24</span> (<span class="keyword">from</span> flask)</span><br><span class="line">  Downloading https://files.pythonhosted.org/packages/<span class="number">76</span>/ae/<span class="number">44</span>b03b253d6fade317f32c24d100b3b35c2239807046a4c953c7b89fa49e/itsdangerous<span class="number">-1.1</span><span class="number">.0</span>-py2.py3-none-any.whl</span><br><span class="line">Collecting click&gt;=<span class="number">5.1</span> (<span class="keyword">from</span> flask)</span><br><span class="line">  Downloading https://files.pythonhosted.org/packages/fa/<span class="number">37</span>/<span class="number">45185</span>cb5abbc30d7257104c434fe0b07e5a195a6847506c074527aa599ec/Click<span class="number">-7.0</span>-py2.py3-none-any.whl (<span class="number">81</span>kB)</span><br><span class="line">    <span class="number">100</span>% |████████████████████████████████| <span class="number">81</span>kB <span class="number">15.2</span>MB/s</span><br><span class="line">Collecting MarkupSafe&gt;=0.23 (from Jinja2&gt;=2.10-&gt;flask)</span><br><span class="line">  Downloading https://files.pythonhosted.org/packages/f0/<span class="number">00</span>/a6aea33f5598b080b86d6b6d1214b51afe3ffa6100b902d5aa465080083f/MarkupSafe<span class="number">-1.1</span><span class="number">.1</span>-cp36-cp36m-macosx_10_6_intel.whl</span><br><span class="line">Installing collected packages: MarkupSafe, Jinja2, Werkzeug, itsdangerous, click, flask</span><br><span class="line">Successfully installed Jinja2<span class="number">-2.10</span> MarkupSafe<span class="number">-1.1</span><span class="number">.1</span> Werkzeug<span class="number">-0.14</span><span class="number">.1</span> click<span class="number">-7.0</span> flask<span class="number">-1.0</span><span class="number">.2</span> itsdangerous<span class="number">-1.1</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<p>安装<code>flask</code>的同时，也会安装相关的依赖模块。这样，在虚拟环境中就有了比较多的模块，而且每个模块（或者库）都有一定的版本。</p>
<p>下面按照如下的指令执行，目的是要生成一个名为<code>requirements.txt</code>的文件，在这个文件中，将记录当前虚拟环境中所安装的模块及其版本（注意，<code>requirements.txt</code>文件目录，先下面代码这样指定，是为了后面使用方便。）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(python3venv) $ pip freeze | tee /tmp/requirements.txt</span><br><span class="line">arrow==<span class="number">0.13</span><span class="number">.1</span></span><br><span class="line">Click==<span class="number">7.0</span></span><br><span class="line">Flask==<span class="number">1.0</span><span class="number">.2</span></span><br><span class="line">itsdangerous==<span class="number">1.1</span><span class="number">.0</span></span><br><span class="line">Jinja2==<span class="number">2.10</span></span><br><span class="line">MarkupSafe==<span class="number">1.1</span><span class="number">.1</span></span><br><span class="line">python-dateutil==<span class="number">2.8</span><span class="number">.0</span></span><br><span class="line">six==<span class="number">1.12</span><span class="number">.0</span></span><br><span class="line">Werkzeug==<span class="number">0.14</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<p>有了这个文件，当我们需要重现这个虚拟环境中已经安装的各个模块是，就简单了。</p>
<h3 id="重现虚拟环境配置"><a href="#重现虚拟环境配置" class="headerlink" title="重现虚拟环境配置"></a>重现虚拟环境配置</h3><p>前面，曾经创建了一个Python2的虚拟环境，现在要将刚才在Python3的虚拟环境中安装的各个模块（即配置），移植到Python2的虚拟环境中——注意，这种做法并不提倡，但是，这里纯粹是为演示虚拟环境的重现移植。</p>
<p>首先，将现在的<code>python3venv</code>虚拟环境停用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(python3venv) $ deactivate</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<p>然后激活Python2的虚拟环境<code>python2venv</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ source python2venv/bin/activate</span><br><span class="line">(python2venv) $</span><br></pre></td></tr></table></figure>

<p>升级<code>pip</code>，多数情况下，用<code>pip install –upgrade pip</code>即可，但是，如果遇到了意想不到的事情，可以用下面的方式尝试解决。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ (python2venv) curl https:&#x2F;&#x2F;bootstrap.pypa.io&#x2F;get-pip.py | python</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100 1659k  100 1659k    0     0  2375k      0 --:--:-- --:--:-- --:--:-- 2377k</span><br><span class="line">DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won&#39;t be maintained after that date. A future version of pip will drop support for Python 2.7.</span><br><span class="line">Collecting pip</span><br><span class="line">  Using cached https:&#x2F;&#x2F;files.pythonhosted.org&#x2F;packages&#x2F;d8&#x2F;f3&#x2F;413bab4ff08e1fc4828dfc59996d721917df8e8583ea85385d51125dceff&#x2F;pip-19.0.3-py2.py3-none-any.whl</span><br><span class="line">Installing collected packages: pip</span><br><span class="line">  Found existing installation: pip 9.0.1</span><br><span class="line">    Uninstalling pip-9.0.1:</span><br><span class="line">      Successfully uninstalled pip-9.0.1</span><br><span class="line">Successfully installed pip-19.0.3</span><br></pre></td></tr></table></figure>

<p>现在，要将<code>python3venv</code>中的配置，在当前虚拟环境中重现，方法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ (python2venv) pip install -r &#x2F;tmp&#x2F;requirements.txt</span><br><span class="line">DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won&#39;t be maintained after that date. A future version of pip will drop support for Python 2.7.</span><br><span class="line">Collecting arrow&#x3D;&#x3D;0.13.1 (from -r &#x2F;tmp&#x2F;requirements.txt (line 1))</span><br><span class="line">  Using cached https:&#x2F;&#x2F;files.pythonhosted.org&#x2F;packages&#x2F;f4&#x2F;7f&#x2F;0360628ba40bb93c10cd89cd289b6a8e9ea87b2db884b8edf32c80ee1c73&#x2F;arrow-0.13.1-py2.py3-none-any.whl</span><br><span class="line">Collecting Click&#x3D;&#x3D;7.0 (from -r &#x2F;tmp&#x2F;requirements.txt (line 2))</span><br><span class="line">  Using cached https:&#x2F;&#x2F;files.pythonhosted.org&#x2F;packages&#x2F;fa&#x2F;37&#x2F;45185cb5abbc30d7257104c434fe0b07e5a195a6847506c074527aa599ec&#x2F;Click-7.0-py2.py3-none-any.whl</span><br><span class="line">Collecting Flask&#x3D;&#x3D;1.0.2 (from -r &#x2F;tmp&#x2F;requirements.txt (line 3))</span><br><span class="line">  Using cached https:&#x2F;&#x2F;files.pythonhosted.org&#x2F;packages&#x2F;7f&#x2F;e7&#x2F;08578774ed4536d3242b14dacb4696386634607af824ea997202cd0edb4b&#x2F;Flask-1.0.2-py2.py3-none-any.whl</span><br><span class="line">Collecting itsdangerous&#x3D;&#x3D;1.1.0 (from -r &#x2F;tmp&#x2F;requirements.txt (line 4))</span><br><span class="line">  Using cached https:&#x2F;&#x2F;files.pythonhosted.org&#x2F;packages&#x2F;76&#x2F;ae&#x2F;44b03b253d6fade317f32c24d100b3b35c2239807046a4c953c7b89fa49e&#x2F;itsdangerous-1.1.0-py2.py3-none-any.whl</span><br><span class="line">Collecting Jinja2&#x3D;&#x3D;2.10 (from -r &#x2F;tmp&#x2F;requirements.txt (line 5))</span><br><span class="line">  Using cached https:&#x2F;&#x2F;files.pythonhosted.org&#x2F;packages&#x2F;7f&#x2F;ff&#x2F;ae64bacdfc95f27a016a7bed8e8686763ba4d277a78ca76f32659220a731&#x2F;Jinja2-2.10-py2.py3-none-any.whl</span><br><span class="line">Collecting MarkupSafe&#x3D;&#x3D;1.1.1 (from -r &#x2F;tmp&#x2F;requirements.txt (line 6))</span><br><span class="line">  Downloading https:&#x2F;&#x2F;files.pythonhosted.org&#x2F;packages&#x2F;6d&#x2F;d2&#x2F;0ccd2c0e2cd93b35e765d9b3205cd6602e6b202b522fc7997531353715b3&#x2F;MarkupSafe-1.1.1-cp27-cp27m-macosx_10_6_intel.whl</span><br><span class="line">Collecting python-dateutil&#x3D;&#x3D;2.8.0 (from -r &#x2F;tmp&#x2F;requirements.txt (line 7))</span><br><span class="line">  Using cached https:&#x2F;&#x2F;files.pythonhosted.org&#x2F;packages&#x2F;41&#x2F;17&#x2F;c62faccbfbd163c7f57f3844689e3a78bae1f403648a6afb1d0866d87fbb&#x2F;python_dateutil-2.8.0-py2.py3-none-any.whl</span><br><span class="line">Collecting six&#x3D;&#x3D;1.12.0 (from -r &#x2F;tmp&#x2F;requirements.txt (line 8))</span><br><span class="line">  Using cached https:&#x2F;&#x2F;files.pythonhosted.org&#x2F;packages&#x2F;73&#x2F;fb&#x2F;00a976f728d0d1fecfe898238ce23f502a721c0ac0ecfedb80e0d88c64e9&#x2F;six-1.12.0-py2.py3-none-any.whl</span><br><span class="line">Collecting Werkzeug&#x3D;&#x3D;0.14.1 (from -r &#x2F;tmp&#x2F;requirements.txt (line 9))</span><br><span class="line">  Using cached https:&#x2F;&#x2F;files.pythonhosted.org&#x2F;packages&#x2F;20&#x2F;c4&#x2F;12e3e56473e52375aa29c4764e70d1b8f3efa6682bef8d0aae04fe335243&#x2F;Werkzeug-0.14.1-py2.py3-none-any.whl</span><br><span class="line">Collecting backports.functools-lru-cache&gt;&#x3D;1.2.1; python_version &#x3D;&#x3D; &quot;2.7&quot; (from arrow&#x3D;&#x3D;0.13.1-&gt;-r &#x2F;tmp&#x2F;requirements.txt (line 1))</span><br><span class="line">  Downloading https:&#x2F;&#x2F;files.pythonhosted.org&#x2F;packages&#x2F;03&#x2F;8e&#x2F;2424c0e65c4a066e28f539364deee49b6451f8fcd4f718fefa50cc3dcf48&#x2F;backports.functools_lru_cache-1.5-py2.py3-none-any.whl</span><br><span class="line">Installing collected packages: six, python-dateutil, backports.functools-lru-cache, arrow, Click, MarkupSafe, Jinja2, itsdangerous, Werkzeug, Flask</span><br><span class="line">Successfully installed Click-7.0 Flask-1.0.2 Jinja2-2.10 MarkupSafe-1.1.1 Werkzeug-0.14.1 arrow-0.13.1 backports.functools-lru-cache-1.5 itsdangerous-1.1.0 python-dateutil-2.8.0 six-1.12.0</span><br></pre></td></tr></table></figure>

<p>虽然现在是一个Python2的虚拟环境，但是也按照<code>requirement.txt</code>文件中的记录，配置了与Python3虚拟环境相同的各个模块，并且还根据Python2的特定要求，增加了应有的依赖<code>backports.functools-lru-cache==1.5</code> 。于是当前虚拟环境中的配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(python2venv) $ pip freeze</span><br><span class="line">DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won&#39;t be maintained after that date. A future version of pip will drop support for Python 2.7.</span><br><span class="line">arrow&#x3D;&#x3D;0.13.1</span><br><span class="line">backports.functools-lru-cache&#x3D;&#x3D;1.5</span><br><span class="line">Click&#x3D;&#x3D;7.0</span><br><span class="line">Flask&#x3D;&#x3D;1.0.2</span><br><span class="line">itsdangerous&#x3D;&#x3D;1.1.0</span><br><span class="line">Jinja2&#x3D;&#x3D;2.10</span><br><span class="line">MarkupSafe&#x3D;&#x3D;1.1.1</span><br><span class="line">python-dateutil&#x3D;&#x3D;2.8.0</span><br><span class="line">six&#x3D;&#x3D;1.12.0</span><br><span class="line">Werkzeug&#x3D;&#x3D;0.14.1</span><br></pre></td></tr></table></figure>

<h2 id="不激活的情况下，使用虚拟环境"><a href="#不激活的情况下，使用虚拟环境" class="headerlink" title="不激活的情况下，使用虚拟环境"></a>不激活的情况下，使用虚拟环境</h2><p>一般情况下，按照上面所说的，激活虚拟环境，然后开始使用，这已经很方便了。但是，在某些情况下，或许有不激活虚拟环境的需求。</p>
<p>为此，可以这么做。比如要执行虚拟环境<code>python3venv</code>中的Python3，可以在没有激活任何虚拟环境的情况下，直接执行<code>python3venv/bin/python</code>运行<code>python3venv</code>中的Python。</p>
<p>在下面的操作中，首先要从<code>python2venv</code>的虚拟环境中退出。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">(python2venv) $ deactivate</span><br><span class="line">$ python3venv/bin/python</span><br><span class="line">Python <span class="number">3.6</span><span class="number">.4</span> (v3<span class="number">.6</span><span class="number">.4</span>:d48ecebad5, Dec <span class="number">18</span> <span class="number">2017</span>, <span class="number">21</span>:<span class="number">07</span>:<span class="number">28</span>)</span><br><span class="line">[GCC <span class="number">4.2</span><span class="number">.1</span> (Apple Inc. build <span class="number">5666</span>) (dot <span class="number">3</span>)] on darwin</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> arrow</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(arrow)</span><br><span class="line">&lt;module <span class="string">'arrow'</span> <span class="keyword">from</span> <span class="string">'/Users/james/python3venv/lib/python3.6/site-packages/arrow/__init__.py'</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>^D</span><br><span class="line"></span><br><span class="line">$ python2venv/bin/python</span><br><span class="line">Python <span class="number">2.7</span><span class="number">.14</span> (v2<span class="number">.7</span><span class="number">.14</span>:<span class="number">84471935</span>ed, Sep <span class="number">16</span> <span class="number">2017</span>, <span class="number">12</span>:<span class="number">01</span>:<span class="number">12</span>)</span><br><span class="line">[GCC <span class="number">4.2</span><span class="number">.1</span> (Apple Inc. build <span class="number">5666</span>) (dot <span class="number">3</span>)] on darwin</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> arrow</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(arrow)</span><br><span class="line">&lt;module <span class="string">'arrow'</span> <span class="keyword">from</span> <span class="string">'/Users/james/python2venv/lib/python2.7/site-packages/arrow/__init__.pyc'</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>^D</span><br></pre></td></tr></table></figure>

<p>在程序文件中，也可以指定所使用的虚拟环境，方法就是用<code>#!</code>发起指令，如下面的代码所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cat &lt;&lt;EOF &gt; test.py</span><br><span class="line">&gt; <span class="comment">#!/Users/james/python3venv/bin/python</span></span><br><span class="line">&gt;</span><br><span class="line">&gt; <span class="keyword">import</span> arrow</span><br><span class="line">&gt; utc = arrow.utcnow()</span><br><span class="line">&gt; print(utc)</span><br><span class="line">&gt; EOF</span><br></pre></td></tr></table></figure>

<p>设置示例文件<code>test.py</code>可执行，然后执行，可以确认执行了虚拟环境中的模块。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ chmod u+x test.py</span><br><span class="line">$ ./test.py</span><br><span class="line"><span class="number">2019</span><span class="number">-03</span><span class="number">-03</span>T21:<span class="number">17</span>:<span class="number">22.632130</span>+<span class="number">00</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>

<p>如此，即可根据特定需求执行程序了。</p>
<h2 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h2><p>如果在本地完成了开发，要将程序移植到别的机器上，通常要在目标机器上配置与本地一样的环境。当然，现在有一种容器化的方案，比如使用docker等。如果不那样做，按照上面的方法完成了虚拟环境的配置，并且在虚拟环境中完成了程序编写。那么，就可以将真个虚拟环境打包。当然，这里有一个前提，目标机器上必须安装了与虚拟环境中相同版本的Python。</p>
<p>以前面使用过的<code>python3venv</code>为例，用<code>tar</code>命令将目录<code>python3venv</code>打包。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tar cf python3venv.tar python3venv</span><br></pre></td></tr></table></figure>

<p>为了演示需要，将当前的<code>python3venv</code>目录删除。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rm -rf python3venv</span><br></pre></td></tr></table></figure>

<p>然后从<code>python3venv.tar</code>中将目录提取出来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tar xf python3venv.tar</span><br></pre></td></tr></table></figure>

<p>继续使用<code>test.py</code>测试一下，<code>python3venv</code>虚拟目录及其内部安装的各模块，都已经恢复。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;test.py</span><br><span class="line">2019-03-03T21:26:47.082092+00:00</span><br></pre></td></tr></table></figure>

<h2 id="用pip管理虚拟环境"><a href="#用pip管理虚拟环境" class="headerlink" title="用pip管理虚拟环境"></a>用pip管理虚拟环境</h2><p>pip是一个好工具，它为管理和维护虚拟环境及其依赖提供简便方法。比如，对于虚拟环境<code>python3venv</code>中的模块，如果要删除<code>arrow</code>和<code>flask</code>，如下操作所示，使用<code>pip uninstall packagename</code>即可，不过，安装时候所安装的那些依赖项会依然保留。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(python3venv) $ pip uninstall arrow flask</span><br><span class="line">Uninstalling arrow-0.13.1:</span><br><span class="line">  Would remove:</span><br><span class="line">    &#x2F;Users&#x2F;james&#x2F;python3venv&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;arrow-0.13.1.dist-info&#x2F;*</span><br><span class="line">    &#x2F;Users&#x2F;james&#x2F;python3venv&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;arrow&#x2F;*</span><br><span class="line">Proceed (y&#x2F;n)? y</span><br><span class="line">  Successfully uninstalled arrow-0.13.1</span><br><span class="line">Uninstalling Flask-1.0.2:</span><br><span class="line">  Would remove:</span><br><span class="line">    &#x2F;Users&#x2F;james&#x2F;python3venv&#x2F;bin&#x2F;flask</span><br><span class="line">    &#x2F;Users&#x2F;james&#x2F;python3venv&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;Flask-1.0.2.dist-info&#x2F;*</span><br><span class="line">    &#x2F;Users&#x2F;james&#x2F;python3venv&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;flask&#x2F;*</span><br><span class="line">Proceed (y&#x2F;n)? y</span><br><span class="line">  Successfully uninstalled Flask-1.0.2</span><br><span class="line">(python3venv) $ pip freeze</span><br><span class="line">Click&#x3D;&#x3D;7.0</span><br><span class="line">itsdangerous&#x3D;&#x3D;1.1.0</span><br><span class="line">Jinja2&#x3D;&#x3D;2.10</span><br><span class="line">MarkupSafe&#x3D;&#x3D;1.1.1</span><br><span class="line">python-dateutil&#x3D;&#x3D;2.8.0</span><br><span class="line">six&#x3D;&#x3D;1.12.0</span><br><span class="line">Werkzeug&#x3D;&#x3D;0.14.1</span><br></pre></td></tr></table></figure>

<p>除了上面简单的方法之外，还可以通过<code>pip-tools</code>中的工具，实现对模块更灵活的管理。</p>
<p>首先，要退出当前的虚拟环境，并删除<code>python3venv</code>目录。然后，重新创建虚拟环境——从这就可以看出虚拟环境的优势，你可以任意删除和重建，每次重建之后它都是“干干净净”的。</p>
<p>进入到新建的虚拟环境之后，升级<code>pip</code>——这是常规套路。再安装<code>pip-tools</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(python3venv) $ deactivate</span><br><span class="line">$ rm -rf python3venv</span><br><span class="line">$ python3 -m venv python3venv</span><br><span class="line">$ source python3venv/bin/activate</span><br><span class="line">(python3venv) $ pip install --upgrade pip</span><br><span class="line">Cache entry deserialization failed, entry ignored</span><br><span class="line">Collecting pip</span><br><span class="line">  Using cached https://files.pythonhosted.org/packages/d8/f3/<span class="number">413</span>bab4ff08e1fc4828dfc59996d721917df8e8583ea85385d51125dceff/pip<span class="number">-19.0</span><span class="number">.3</span>-py2.py3-none-any.whl</span><br><span class="line">Installing collected packages: pip</span><br><span class="line">  Found existing installation: pip <span class="number">9.0</span><span class="number">.1</span></span><br><span class="line">    Uninstalling pip<span class="number">-9.0</span><span class="number">.1</span>:</span><br><span class="line">      Successfully uninstalled pip<span class="number">-9.0</span><span class="number">.1</span></span><br><span class="line">Successfully installed pip<span class="number">-19.0</span><span class="number">.3</span></span><br><span class="line"></span><br><span class="line">(python3venv) $ pip install pip-tools</span><br><span class="line">Collecting pip-tools</span><br><span class="line">  Downloading https://files.pythonhosted.org/packages/<span class="number">58</span>/<span class="number">7</span>a/f93b24807b7ac2d9d0bd6b8a886bcbe67eb39c1b1184b985dd5e0e2eca92/pip_tools<span class="number">-3.4</span><span class="number">.0</span>-py2.py3-none-any.whl (<span class="number">43</span>kB)</span><br><span class="line">    <span class="number">100</span>% |████████████████████████████████| <span class="number">51</span>kB <span class="number">2.3</span>MB/s</span><br><span class="line">Collecting six (<span class="keyword">from</span> pip-tools)</span><br><span class="line">  Using cached https://files.pythonhosted.org/packages/<span class="number">73</span>/fb/<span class="number">00</span>a976f728d0d1fecfe898238ce23f502a721c0ac0ecfedb80e0d88c64e9/six<span class="number">-1.12</span><span class="number">.0</span>-py2.py3-none-any.whl</span><br><span class="line">Collecting click&gt;=<span class="number">6</span> (<span class="keyword">from</span> pip-tools)</span><br><span class="line">  Using cached https://files.pythonhosted.org/packages/fa/<span class="number">37</span>/<span class="number">45185</span>cb5abbc30d7257104c434fe0b07e5a195a6847506c074527aa599ec/Click<span class="number">-7.0</span>-py2.py3-none-any.whl</span><br><span class="line">Installing collected packages: six, click, pip-tools</span><br><span class="line">Successfully installed click<span class="number">-7.0</span> pip-tools<span class="number">-3.4</span><span class="number">.0</span> six<span class="number">-1.12</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<p>创建一个名为<code>requirements.in</code>的文件，在其中写上需要的模块及其版版本，比如<code>arrow</code>和<code>flask</code>，版本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(python3venv) $ cat &lt;&lt;EOF &gt; requirements.<span class="keyword">in</span></span><br><span class="line">&gt; arrow==<span class="number">0.13</span><span class="number">.1</span></span><br><span class="line">&gt; Flask==<span class="number">1.0</span><span class="number">.2</span></span><br><span class="line">&gt; EOF</span><br></pre></td></tr></table></figure>

<p>然后，使用<code>pip-compile</code> （是<code>pip-tools</code>中提供的），依据<code>requirements.in</code>创建<code>requirements.txt</code>文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">(python3venv) $ pip-compile --generate-hashes --output-file requirements.txt requirements.<span class="keyword">in</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This file is autogenerated by pip-compile</span></span><br><span class="line"><span class="comment"># To update, run:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    pip-compile --generate-hashes --output-file requirements.txt requirements.in</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">arrow==<span class="number">0.13</span><span class="number">.1</span> \</span><br><span class="line">    --hash=sha256:<span class="number">3397e5448952</span>e18e1295bf047014659effa5ae8da6a5371d37ff0ddc46fa6872 \</span><br><span class="line">    --hash=sha256:<span class="number">6</span>f54d9f016c0b7811fac9fb8c2c7fa7421d80c54dbdd75ffb12913c55db60b8a</span><br><span class="line">click==<span class="number">7.0</span> \</span><br><span class="line">    --hash=sha256:<span class="number">2335065e6395</span>b9e67ca716de5f7526736bfa6ceead690adf616d925bdc622b13 \</span><br><span class="line">    --hash=sha256:<span class="number">5</span>b94b49521f6456670fdb30cd82a4eca9412788a93fa6dd6df72c94d5a8ff2d7 \</span><br><span class="line">    <span class="comment"># via flask</span></span><br><span class="line">flask==<span class="number">1.0</span><span class="number">.2</span> \</span><br><span class="line">    --hash=sha256:<span class="number">2271</span>c0070dbcb5275fad4a82e29f23ab92682dc45f9dfbc22c02ba9b9322ce48 \</span><br><span class="line">    --hash=sha256:a080b744b7e345ccfcbc77954861cb05b3c63786e93f2b3875e0913d44b43f05</span><br><span class="line">itsdangerous==<span class="number">1.1</span><span class="number">.0</span> \</span><br><span class="line">    --hash=sha256:<span class="number">321</span>b033d07f2a4136d3ec762eac9f16a10ccd60f53c0c91af90217ace7ba1f19 \</span><br><span class="line">    --hash=sha256:b12271b2047cb23eeb98c8b5622e2e5c5e9abd9784a153e9d8ef9cb4dd09d749 \</span><br><span class="line">    <span class="comment"># via flask</span></span><br><span class="line">jinja2==<span class="number">2.10</span> \</span><br><span class="line">    --hash=sha256:<span class="number">74</span>c935a1b8bb9a3947c50a54766a969d4846290e1e788ea44c1392163723c3bd \</span><br><span class="line">    --hash=sha256:f84be1bb0040caca4cea721fcbbbbd61f9be9464ca236387158b0feea01914a4 \</span><br><span class="line">    <span class="comment"># via flask</span></span><br><span class="line">markupsafe==<span class="number">1.1</span><span class="number">.1</span> \</span><br><span class="line">    --hash=sha256:<span class="number">00</span>bc623926325b26bb9605ae9eae8a215691f33cae5df11ca5424f06f2d1f473 \</span><br><span class="line">    --hash=sha256:<span class="number">09027</span>a7803a62ca78792ad89403b1b7a73a01c8cb65909cd876f7fcebd79b161 \</span><br><span class="line">    --hash=sha256:<span class="number">09</span>c4b7f37d6c648cb13f9230d847adf22f8171b1ccc4d5682398e77f40309235 \</span><br><span class="line">    --hash=sha256:<span class="number">1027</span>c282dad077d0bae18be6794e6b6b8c91d58ed8a8d89a89d59693b9131db5 \</span><br><span class="line">    --hash=sha256:<span class="number">24982</span>cc2533820871eba85ba648cd53d8623687ff11cbb805be4ff7b4c971aff \</span><br><span class="line">    --hash=sha256:<span class="number">29872e92839765</span>e546828bb7754a68c418d927cd064fd4708fab9fe9c8bb116b \</span><br><span class="line">    --hash=sha256:<span class="number">43</span>a55c2930bbc139570ac2452adf3d70cdbb3cfe5912c71cdce1c2c6bbd9c5d1 \</span><br><span class="line">    --hash=sha256:<span class="number">46</span>c99d2de99945ec5cb54f23c8cd5689f6d7177305ebff350a58ce5f8de1669e \</span><br><span class="line">    --hash=sha256:<span class="number">500</span>d4957e52ddc3351cabf489e79c91c17f6e0899158447047588650b5e69183 \</span><br><span class="line">    --hash=sha256:<span class="number">535</span>f6fc4d397c1563d08b88e485c3496cf5784e927af890fb3c3aac7f933ec66 \</span><br><span class="line">    --hash=sha256:<span class="number">62</span>fe6c95e3ec8a7fad637b7f3d372c15ec1caa01ab47926cfdf7a75b40e0eac1 \</span><br><span class="line">    --hash=sha256:<span class="number">6</span>dd73240d2af64df90aa7c4e7481e23825ea70af4b4922f8ede5b9e35f78a3b1 \</span><br><span class="line">    --hash=sha256:<span class="number">717</span>ba8fe3ae9cc0006d7c451f0bb265ee07739daf76355d06366154ee68d221e \</span><br><span class="line">    --hash=sha256:<span class="number">79855e1</span>c5b8da654cf486b830bd42c06e8780cea587384cf6545b7d9ac013a0b \</span><br><span class="line">    --hash=sha256:<span class="number">7</span>c1699dfe0cf8ff607dbdcc1e9b9af1755371f92a68f706051cc8c37d447c905 \</span><br><span class="line">    --hash=sha256:<span class="number">88e5</span>fcfb52ee7b911e8bb6d6aa2fd21fbecc674eadd44118a9cc3863f938e735 \</span><br><span class="line">    --hash=sha256:<span class="number">8</span>defac2f2ccd6805ebf65f5eeb132adcf2ab57aa11fdf4c0dd5169a004710e7d \</span><br><span class="line">    --hash=sha256:<span class="number">98</span>c7086708b163d425c67c7a91bad6e466bb99d797aa64f965e9d25c12111a5e \</span><br><span class="line">    --hash=sha256:<span class="number">9</span>add70b36c5666a2ed02b43b335fe19002ee5235efd4b8a89bfcf9005bebac0d \</span><br><span class="line">    --hash=sha256:<span class="number">9</span>bf40443012702a1d2070043cb6291650a0841ece432556f784f004937f0f32c \</span><br><span class="line">    --hash=sha256:ade5e387d2ad0d7ebf59146cc00c8044acbd863725f887353a10df825fc8ae21 \</span><br><span class="line">    --hash=sha256:b00c1de48212e4cc9603895652c5c410df699856a2853135b3967591e4beebc2 \</span><br><span class="line">    --hash=sha256:b1282f8c00509d99fef04d8ba936b156d419be841854fe901d8ae224c59f0be5 \</span><br><span class="line">    --hash=sha256:b2051432115498d3562c084a49bba65d97cf251f5a331c64a12ee7e04dacc51b \</span><br><span class="line">    --hash=sha256:ba59edeaa2fc6114428f1637ffff42da1e311e29382d81b339c1817d37ec93c6 \</span><br><span class="line">    --hash=sha256:c8716a48d94b06bb3b2524c2b77e055fb313aeb4ea620c8dd03a105574ba704f \</span><br><span class="line">    --hash=sha256:cd5df75523866410809ca100dc9681e301e3c27567cf498077e8551b6d20e42f \</span><br><span class="line">    --hash=sha256:e249096428b3ae81b08327a63a485ad0878de3fb939049038579ac0ef61e17e7 \</span><br><span class="line">    <span class="comment"># via jinja2</span></span><br><span class="line">python-dateutil==<span class="number">2.8</span><span class="number">.0</span> \</span><br><span class="line">    --hash=sha256:<span class="number">7e6584</span>c74aeed623791615e26efd690f29817a27c73085b78e4bad02493df2fb \</span><br><span class="line">    --hash=sha256:c89805f6f4d64db21ed966fda138f8a5ed7a4fdbc1a8ee329ce1b74e3c74da9e \</span><br><span class="line">    <span class="comment"># via arrow</span></span><br><span class="line">six==<span class="number">1.12</span><span class="number">.0</span> \</span><br><span class="line">    --hash=sha256:<span class="number">3350809</span>f0555b11f552448330d0b52d5f24c91a322ea4a15ef22629740f3761c \</span><br><span class="line">    --hash=sha256:d16a0141ec1a18405cd4ce8b4613101da75da0e9a7aec5bdd4fa804d0e0eba73 \</span><br><span class="line">    <span class="comment"># via python-dateutil</span></span><br><span class="line">werkzeug==<span class="number">0.14</span><span class="number">.1</span> \</span><br><span class="line">    --hash=sha256:c3fd7a7d41976d9f44db327260e263132466836cef6f91512889ed60ad26557c \</span><br><span class="line">    --hash=sha256:d5da73735293558eb1651ee2fddc4d0dedcfa06538b8813a2e20011583c9e49b \</span><br><span class="line">    <span class="comment"># via flask</span></span><br></pre></td></tr></table></figure>

<p>从上述信息中可以看到，每个依赖都有相应的哈希值，这样能够保证所安装的模块彼此之间没有冲突。</p>
<p>有了<code>requirements.txt</code>文件之后，就可以使用<code>pip-sync</code>（也是<code>pip-tools</code>中的一个工具）将虚拟环境中的配置与之同步。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">(python3venv) $ pip-sync</span><br><span class="line">Collecting arrow==<span class="number">0.13</span><span class="number">.1</span> (<span class="keyword">from</span> -r /var/folders/xk/p46swdnn3b56rbd01qwdjhdh0000gn/T/tmpfwkk4j83 (line <span class="number">1</span>))</span><br><span class="line">  Using cached https://files.pythonhosted.org/packages/f4/<span class="number">7</span>f/<span class="number">0360628</span>ba40bb93c10cd89cd289b6a8e9ea87b2db884b8edf32c80ee1c73/arrow<span class="number">-0.13</span><span class="number">.1</span>-py2.py3-none-any.whl</span><br><span class="line">Collecting flask==<span class="number">1.0</span><span class="number">.2</span> (<span class="keyword">from</span> -r /var/folders/xk/p46swdnn3b56rbd01qwdjhdh0000gn/T/tmpfwkk4j83 (line <span class="number">4</span>))</span><br><span class="line">  Using cached https://files.pythonhosted.org/packages/<span class="number">7</span>f/e7/<span class="number">08578774</span>ed4536d3242b14dacb4696386634607af824ea997202cd0edb4b/Flask<span class="number">-1.0</span><span class="number">.2</span>-py2.py3-none-any.whl</span><br><span class="line">Collecting itsdangerous==<span class="number">1.1</span><span class="number">.0</span> (<span class="keyword">from</span> -r /var/folders/xk/p46swdnn3b56rbd01qwdjhdh0000gn/T/tmpfwkk4j83 (line <span class="number">7</span>))</span><br><span class="line">  Using cached https://files.pythonhosted.org/packages/<span class="number">76</span>/ae/<span class="number">44</span>b03b253d6fade317f32c24d100b3b35c2239807046a4c953c7b89fa49e/itsdangerous<span class="number">-1.1</span><span class="number">.0</span>-py2.py3-none-any.whl</span><br><span class="line">Collecting jinja2==<span class="number">2.10</span> (<span class="keyword">from</span> -r /var/folders/xk/p46swdnn3b56rbd01qwdjhdh0000gn/T/tmpfwkk4j83 (line <span class="number">10</span>))</span><br><span class="line">  Using cached https://files.pythonhosted.org/packages/<span class="number">7</span>f/ff/ae64bacdfc95f27a016a7bed8e8686763ba4d277a78ca76f32659220a731/Jinja2<span class="number">-2.10</span>-py2.py3-none-any.whl</span><br><span class="line">Collecting markupsafe==<span class="number">1.1</span><span class="number">.1</span> (<span class="keyword">from</span> -r /var/folders/xk/p46swdnn3b56rbd01qwdjhdh0000gn/T/tmpfwkk4j83 (line <span class="number">13</span>))</span><br><span class="line">  Using cached https://files.pythonhosted.org/packages/f0/<span class="number">00</span>/a6aea33f5598b080b86d6b6d1214b51afe3ffa6100b902d5aa465080083f/MarkupSafe<span class="number">-1.1</span><span class="number">.1</span>-cp36-cp36m-macosx_10_6_intel.whl</span><br><span class="line">Collecting python-dateutil==<span class="number">2.8</span><span class="number">.0</span> (<span class="keyword">from</span> -r /var/folders/xk/p46swdnn3b56rbd01qwdjhdh0000gn/T/tmpfwkk4j83 (line <span class="number">42</span>))</span><br><span class="line">  Using cached https://files.pythonhosted.org/packages/<span class="number">41</span>/<span class="number">17</span>/c62faccbfbd163c7f57f3844689e3a78bae1f403648a6afb1d0866d87fbb/python_dateutil<span class="number">-2.8</span><span class="number">.0</span>-py2.py3-none-any.whl</span><br><span class="line">Collecting werkzeug==<span class="number">0.14</span><span class="number">.1</span> (<span class="keyword">from</span> -r /var/folders/xk/p46swdnn3b56rbd01qwdjhdh0000gn/T/tmpfwkk4j83 (line <span class="number">45</span>))</span><br><span class="line">  Using cached https://files.pythonhosted.org/packages/<span class="number">20</span>/c4/<span class="number">12e3</span>e56473e52375aa29c4764e70d1b8f3efa6682bef8d0aae04fe335243/Werkzeug<span class="number">-0.14</span><span class="number">.1</span>-py2.py3-none-any.whl</span><br><span class="line">Requirement already satisfied: click&gt;=5.1 in ./python3venv/lib/python3.6/site-packages (from flask==1.0.2-&gt;-r /var/folders/xk/p46swdnn3b56rbd01qwdjhdh0000gn/T/tmpfwkk4j83 (line 4)) (7.0)</span><br><span class="line">Requirement already satisfied: six&gt;=1.5 in ./python3venv/lib/python3.6/site-packages (from python-dateutil==2.8.0-&gt;-r /var/folders/xk/p46swdnn3b56rbd01qwdjhdh0000gn/T/tmpfwkk4j83 (line 42)) (1.12.0)</span><br><span class="line">Installing collected packages: python-dateutil, arrow, werkzeug, itsdangerous, markupsafe, jinja2, flask</span><br><span class="line">Successfully installed arrow<span class="number">-0.13</span><span class="number">.1</span> flask<span class="number">-1.0</span><span class="number">.2</span> itsdangerous<span class="number">-1.1</span><span class="number">.0</span> jinja2<span class="number">-2.10</span> markupsafe<span class="number">-1.1</span><span class="number">.1</span> python-dateutil<span class="number">-2.8</span><span class="number">.0</span> werkzeug<span class="number">-0.14</span><span class="number">.1</span></span><br><span class="line">(python3venv) $ pip freeze</span><br><span class="line">arrow==<span class="number">0.13</span><span class="number">.1</span></span><br><span class="line">Click==<span class="number">7.0</span></span><br><span class="line">Flask==<span class="number">1.0</span><span class="number">.2</span></span><br><span class="line">itsdangerous==<span class="number">1.1</span><span class="number">.0</span></span><br><span class="line">Jinja2==<span class="number">2.10</span></span><br><span class="line">MarkupSafe==<span class="number">1.1</span><span class="number">.1</span></span><br><span class="line">pip-tools==<span class="number">3.4</span><span class="number">.0</span></span><br><span class="line">python-dateutil==<span class="number">2.8</span><span class="number">.0</span></span><br><span class="line">six==<span class="number">1.12</span><span class="number">.0</span></span><br><span class="line">Werkzeug==<span class="number">0.14</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<p>如果删除一个模块，例如删除Flask，只需要更新<code>requirements.in</code>文件，如下所示。然后重复上面的过程，使用<code>pip-sync</code>，就可以从当前虚拟环境中删除Flask，并且，在安装的时候，随着一同安装上的各种依赖模块，也同时被移除。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">(python3venv) $ cat &lt;&lt;EOF &gt; requirements.<span class="keyword">in</span></span><br><span class="line">&gt; arrow==<span class="number">0.13</span><span class="number">.1</span></span><br><span class="line">&gt; EOF</span><br><span class="line">(python3venv) $ pip-compile --generate-hashes --output-file requirements.txt requirements.<span class="keyword">in</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This file is autogenerated by pip-compile</span></span><br><span class="line"><span class="comment"># To update, run:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    pip-compile --generate-hashes --output-file requirements.txt requirements.in</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">arrow==<span class="number">0.13</span><span class="number">.1</span> \</span><br><span class="line">    --hash=sha256:<span class="number">3397e5448952</span>e18e1295bf047014659effa5ae8da6a5371d37ff0ddc46fa6872 \</span><br><span class="line">    --hash=sha256:<span class="number">6</span>f54d9f016c0b7811fac9fb8c2c7fa7421d80c54dbdd75ffb12913c55db60b8a</span><br><span class="line">python-dateutil==<span class="number">2.8</span><span class="number">.0</span> \</span><br><span class="line">    --hash=sha256:<span class="number">7e6584</span>c74aeed623791615e26efd690f29817a27c73085b78e4bad02493df2fb \</span><br><span class="line">    --hash=sha256:c89805f6f4d64db21ed966fda138f8a5ed7a4fdbc1a8ee329ce1b74e3c74da9e \</span><br><span class="line">    <span class="comment"># via arrow</span></span><br><span class="line">six==<span class="number">1.12</span><span class="number">.0</span> \</span><br><span class="line">    --hash=sha256:<span class="number">3350809</span>f0555b11f552448330d0b52d5f24c91a322ea4a15ef22629740f3761c \</span><br><span class="line">    --hash=sha256:d16a0141ec1a18405cd4ce8b4613101da75da0e9a7aec5bdd4fa804d0e0eba73 \</span><br><span class="line">    <span class="comment"># via python-dateutil</span></span><br><span class="line">(python3venv) $ pip-sync</span><br><span class="line">Uninstalling Flask<span class="number">-1.0</span><span class="number">.2</span>:</span><br><span class="line">  Successfully uninstalled Flask<span class="number">-1.0</span><span class="number">.2</span></span><br><span class="line">Uninstalling itsdangerous<span class="number">-1.1</span><span class="number">.0</span>:</span><br><span class="line">  Successfully uninstalled itsdangerous<span class="number">-1.1</span><span class="number">.0</span></span><br><span class="line">Uninstalling Jinja2<span class="number">-2.10</span>:</span><br><span class="line">  Successfully uninstalled Jinja2<span class="number">-2.10</span></span><br><span class="line">Uninstalling MarkupSafe<span class="number">-1.1</span><span class="number">.1</span>:</span><br><span class="line">  Successfully uninstalled MarkupSafe<span class="number">-1.1</span><span class="number">.1</span></span><br><span class="line">Uninstalling Werkzeug<span class="number">-0.14</span><span class="number">.1</span>:</span><br><span class="line">  Successfully uninstalled Werkzeug<span class="number">-0.14</span><span class="number">.1</span></span><br><span class="line">(python3venv) $ pip freeze</span><br><span class="line">arrow==<span class="number">0.13</span><span class="number">.1</span></span><br><span class="line">Click==<span class="number">7.0</span></span><br><span class="line">pip-tools==<span class="number">3.4</span><span class="number">.0</span></span><br><span class="line">python-dateutil==<span class="number">2.8</span><span class="number">.0</span></span><br><span class="line">six==<span class="number">1.12</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<h2 id="指定PyPi库"><a href="#指定PyPi库" class="headerlink" title="指定PyPi库"></a>指定PyPi库</h2><p>如果需要将虚拟环境与特定的PyPi库关联起来，即要求安装指定的PyP中的模块或者库，为此需要在虚拟环境的根目录下创建一个名为<code>pip.conf</code>的配置文件，在这个文件中声明安装依赖的属性。下面是一个<code>pip.conf</code>的例子，要根据需要修改<a href="http://hostname.spurin.com" target="_blank" rel="noopener">hostname.spurin.com</a> 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">global</span>]</span><br><span class="line">disable-pip-version-check = <span class="literal">True</span></span><br><span class="line">trusted-host = hostname.spurin.com</span><br><span class="line">index = https://hostname.spurin.com/repository/pypi-all/pypi</span><br><span class="line">index-url = https://hostname.spurin.com/repository/pypi-all/simple</span><br></pre></td></tr></table></figure>

<h2 id="创建虚拟环境中模块的轮子"><a href="#创建虚拟环境中模块的轮子" class="headerlink" title="创建虚拟环境中模块的轮子"></a>创建虚拟环境中模块的轮子</h2><p>在<strong><a href="https://qiwsir.github.io/2021/02/27/upgrade-pip/">必须升级pip，为什么？！</a></strong>中曾经介绍了<code>.whl</code>文件的作用，虚拟环境中安装的模块，也可以编译为<code>.whil</code>文件，如果在另外一台机器上再安装同样模块，只需要用<code>pip</code>安装此文件即可，从而让虚拟环境的移植更简单了。</p>
<p>具体操作流程如下所示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">(python3venv) $ pip wheel --wheel-dir&#x3D;&#x2F;tmp&#x2F;wheel-dir -r requirements.txt</span><br><span class="line">Collecting arrow&#x3D;&#x3D;0.13.1 (from -r requirements.txt (line 7))</span><br><span class="line">  Using cached https:&#x2F;&#x2F;files.pythonhosted.org&#x2F;packages&#x2F;f4&#x2F;7f&#x2F;0360628ba40bb93c10cd89cd289b6a8e9ea87b2db884b8edf32c80ee1c73&#x2F;arrow-0.13.1-py2.py3-none-any.whl</span><br><span class="line">  Saved &#x2F;private&#x2F;tmp&#x2F;wheel-dir&#x2F;arrow-0.13.1-py2.py3-none-any.whl</span><br><span class="line">Collecting python-dateutil&#x3D;&#x3D;2.8.0 (from -r requirements.txt (line 10))</span><br><span class="line">  Using cached https:&#x2F;&#x2F;files.pythonhosted.org&#x2F;packages&#x2F;41&#x2F;17&#x2F;c62faccbfbd163c7f57f3844689e3a78bae1f403648a6afb1d0866d87fbb&#x2F;python_dateutil-2.8.0-py2.py3-none-any.whl</span><br><span class="line">  Saved &#x2F;private&#x2F;tmp&#x2F;wheel-dir&#x2F;python_dateutil-2.8.0-py2.py3-none-any.whl</span><br><span class="line">Collecting six&#x3D;&#x3D;1.12.0 (from -r requirements.txt (line 14))</span><br><span class="line">  Using cached https:&#x2F;&#x2F;files.pythonhosted.org&#x2F;packages&#x2F;73&#x2F;fb&#x2F;00a976f728d0d1fecfe898238ce23f502a721c0ac0ecfedb80e0d88c64e9&#x2F;six-1.12.0-py2.py3-none-any.whl</span><br><span class="line">  Saved &#x2F;private&#x2F;tmp&#x2F;wheel-dir&#x2F;six-1.12.0-py2.py3-none-any.whl</span><br><span class="line">  </span><br><span class="line">(python3venv) $ ls &#x2F;tmp&#x2F;wheel-dir</span><br><span class="line">arrow-0.13.1-py2.py3-none-any.whl		python_dateutil-2.8.0-py2.py3-none-any.whl	six-1.12.0-py2.py3-none-any.whl</span><br><span class="line">(python3venv) $ pip uninstall arrow python_dateutil six</span><br><span class="line">Uninstalling arrow-0.13.1:</span><br><span class="line">  Would remove:</span><br><span class="line">    &#x2F;Users&#x2F;james&#x2F;python3venv&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;arrow-0.13.1.dist-info&#x2F;*</span><br><span class="line">    &#x2F;Users&#x2F;james&#x2F;python3venv&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;arrow&#x2F;*</span><br><span class="line">Proceed (y&#x2F;n)? y</span><br><span class="line">  Successfully uninstalled arrow-0.13.1</span><br><span class="line">Uninstalling python-dateutil-2.8.0:</span><br><span class="line">  Would remove:</span><br><span class="line">    &#x2F;Users&#x2F;james&#x2F;python3venv&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;dateutil&#x2F;*</span><br><span class="line">    &#x2F;Users&#x2F;james&#x2F;python3venv&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;python_dateutil-2.8.0.dist-info&#x2F;*</span><br><span class="line">Proceed (y&#x2F;n)? y</span><br><span class="line">  Successfully uninstalled python-dateutil-2.8.0</span><br><span class="line">Uninstalling six-1.12.0:</span><br><span class="line">  Would remove:</span><br><span class="line">    &#x2F;Users&#x2F;james&#x2F;python3venv&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;six-1.12.0.dist-info&#x2F;*</span><br><span class="line">    &#x2F;Users&#x2F;james&#x2F;python3venv&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;six.py</span><br><span class="line">Proceed (y&#x2F;n)? y</span><br><span class="line">  Successfully uninstalled six-1.12.0</span><br><span class="line">(python3venv) $ pip install --find-links&#x3D;&#x2F;tmp&#x2F;wheel-dir -r requirements.txt</span><br><span class="line">Looking in links: &#x2F;tmp&#x2F;wheel-dir</span><br><span class="line">Collecting arrow&#x3D;&#x3D;0.13.1 (from -r requirements.txt (line 7))</span><br><span class="line">Collecting python-dateutil&#x3D;&#x3D;2.8.0 (from -r requirements.txt (line 10))</span><br><span class="line">Collecting six&#x3D;&#x3D;1.12.0 (from -r requirements.txt (line 14))</span><br><span class="line">Installing collected packages: six, python-dateutil, arrow</span><br><span class="line">Successfully installed arrow-0.13.1 python-dateutil-2.8.0 six-1.12.0</span><br></pre></td></tr></table></figure>

<h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>创建虚拟环境的目的，就是隔离特定模块的版本，从而满足不同项目的特定需要。</p>
<p><img src="https://gitee.com/qiwsir/images/raw/master/2021-3-8/1615165356466-pasted-19.png" alt=""></p>
<p>另外，除了上述创建虚拟环境的方法之外，现在也流行着一个名为<code>pipenv</code>的模块，有兴趣的可以试试，代码仓库地址：<a href="https://github.com/pypa/pipenv" target="_blank" rel="noopener">https://github.com/pypa/pipenv</a> 。当然，对它也是仁者见仁智者见智。</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>[1]. <a href="https://spurin.com/2019/03/12/Python-Virtual-Environments/" target="_blank" rel="noopener">https://spurin.com/2019/03/12/Python-Virtual-Environments/</a></p>
</section>
    <!-- Tags START -->
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2021/03/03/python-strings-word/">
        <span class="nav-arrow">← </span>
        
          Python字符串的前世今生
        
      </a>
    
    
      <a class="nav-right" href="/2021/03/10/remove-column-from-dataframe/">
        
          从DataFrame中删除列
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- 打赏 START -->
    
      <div class="money-like">
        <div class="reward-btn">
          赏
          <span class="money-code">
            <span class="alipay-code">
              <div class="code-image"></div>
              <b>使用支付宝打赏</b>
            </span>
            <span class="wechat-code">
              <div class="code-image"></div>
              <b>使用微信打赏</b>
            </span>
          </span>
        </div>
        <p class="notice">若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏</p>
      </div>
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    <!--% if (theme.qrcode) { %-->
      <div class="qrcode">
        <!--canvas id="share-qrcode"></!--canvas-->
        <img src="https://public-tuchuang.oss-cn-hangzhou.aliyuncs.com/WechatIMG6_20200109154827.jpeg" width=400>
        <p class="notice">关注微信公众号，读文章、听课程，提升技能</p>
      </div>
    <!--% } %-->
    <!-- 二维码 END -->
    
      <!-- No Comment -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#导言"><span class="toc-nav-text">导言</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#创建虚拟环境"><span class="toc-nav-text">创建虚拟环境</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#在Python3中创建虚拟环境"><span class="toc-nav-text">在Python3中创建虚拟环境</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#在Python3-6及更低版本中创建虚拟环境"><span class="toc-nav-text">在Python3.6及更低版本中创建虚拟环境</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#在Python2-x中创建虚拟环境"><span class="toc-nav-text">在Python2.x中创建虚拟环境</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#检查虚拟环境"><span class="toc-nav-text">检查虚拟环境</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#激活虚拟环境"><span class="toc-nav-text">激活虚拟环境</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#执行python"><span class="toc-nav-text">执行python</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#用pip安装软件包"><span class="toc-nav-text">用pip安装软件包</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#升级pip"><span class="toc-nav-text">升级pip</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#集成环境需求"><span class="toc-nav-text">集成环境需求</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#重现虚拟环境配置"><span class="toc-nav-text">重现虚拟环境配置</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#不激活的情况下，使用虚拟环境"><span class="toc-nav-text">不激活的情况下，使用虚拟环境</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#打包"><span class="toc-nav-text">打包</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#用pip管理虚拟环境"><span class="toc-nav-text">用pip管理虚拟环境</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#指定PyPi库"><span class="toc-nav-text">指定PyPi库</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#创建虚拟环境中模块的轮子"><span class="toc-nav-text">创建虚拟环境中模块的轮子</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#结束语"><span class="toc-nav-text">结束语</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#参考文献"><span class="toc-nav-text">参考文献</span></a></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'https://qiwsir.github.io/2021/03/08/virtual-environments/';
    var banner = ''
    /*if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }*/
    //$('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>







    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2021 | Proudly powered by 老齐教室 | <a href='http://www.beian.miit.gov.cn' target="_blank" rel="noopener">苏ICP备13034293号-2 </a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->


<script src="/js/script.js"></script>

  </body>
</html>